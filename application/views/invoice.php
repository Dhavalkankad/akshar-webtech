<?php
$countries = [
    // 'AF' => 'Afghanistan',
    // 'AL' => 'Albania',
    // 'DZ' => 'Algeria',
    // 'AS' => 'American Samoa',
    // 'AD' => 'Andorra',
    // 'AO' => 'Angola',
    // 'AI' => 'Anguilla',
    // 'AG' => 'Antigua and Barbuda',
    // 'AR' => 'Argentina',
    // 'AM' => 'Armenia',
    // 'AW' => 'Aruba',
    // 'AU' => 'Australia',
    // 'AT' => 'Austria',
    // 'AZ' => 'Azerbaijan',
    // 'BS' => 'Bahamas',
    // 'BH' => 'Bahrain',
    // 'BD' => 'Bangladesh',
    // 'BB' => 'Barbados',
    // 'BY' => 'Belarus',
    // 'BE' => 'Belgium',
    // 'BZ' => 'Belize',
    // 'BJ' => 'Benin',
    // 'BM' => 'Bermuda',
    // 'BT' => 'Bhutan',
    // 'BO' => 'Bolivia',
    // 'BA' => 'Bosnia and Herzegovina',
    // 'BW' => 'Botswana',
    // 'BR' => 'Brazil',
    // 'BN' => 'Brunei Darussalam',
    // 'BG' => 'Bulgaria',
    // 'BF' => 'Burkina Faso',
    // 'BI' => 'Burundi',
    // 'KH' => 'Cambodia',
    // 'CM' => 'Cameroon',
    // 'CA' => 'Canada',
    // 'CV' => 'Cape Verde',
    // 'KY' => 'Cayman Islands',
    // 'CF' => 'Central African Republic',
    // 'TD' => 'Chad',
    // 'CL' => 'Chile',
    // 'CN' => 'China',
    // 'CO' => 'Colombia',
    // 'KM' => 'Comoros',
    // 'CG' => 'Congo',
    // 'CR' => 'Costa Rica',
    // 'HR' => 'Croatia',
    // 'CU' => 'Cuba',
    // 'CY' => 'Cyprus',
    // 'CZ' => 'Czech Republic',
    // 'DK' => 'Denmark',
    // 'DJ' => 'Djibouti',
    // 'DM' => 'Dominica',
    // 'DO' => 'Dominican Republic',
    // 'EC' => 'Ecuador',
    // 'EG' => 'Egypt',
    // 'SV' => 'El Salvador',
    // 'GQ' => 'Equatorial Guinea',
    // 'ER' => 'Eritrea',
    // 'EE' => 'Estonia',
    // 'SZ' => 'Eswatini',
    // 'ET' => 'Ethiopia',
    // 'FJ' => 'Fiji',
    // 'FI' => 'Finland',
    // 'FR' => 'France',
    // 'GA' => 'Gabon',
    // 'GM' => 'Gambia',
    // 'GE' => 'Georgia',
    // 'DE' => 'Germany',
    // 'GH' => 'Ghana',
    // 'GR' => 'Greece',
    // 'GD' => 'Grenada',
    // 'GT' => 'Guatemala',
    // 'GN' => 'Guinea',
    // 'GW' => 'Guinea-Bissau',
    // 'GY' => 'Guyana',
    // 'HT' => 'Haiti',
    // 'HN' => 'Honduras',
    // 'HK' => 'Hong Kong',
    // 'HU' => 'Hungary',
    // 'IS' => 'Iceland',
    'IN' => 'India',
    // 'ID' => 'Indonesia',
    // 'IR' => 'Iran',
    // 'IQ' => 'Iraq',
    // 'IE' => 'Ireland',
    // 'IL' => 'Israel',
    // 'IT' => 'Italy',
    // 'JM' => 'Jamaica',
    // 'JP' => 'Japan',
    // 'JO' => 'Jordan',
    // 'KZ' => 'Kazakhstan',
    // 'KE' => 'Kenya',
    // 'KI' => 'Kiribati',
    // 'KR' => 'Korea, Republic of',
    // 'KW' => 'Kuwait',
    // 'KG' => 'Kyrgyzstan',
    // 'LA' => 'Lao People\'s Democratic Republic',
    // 'LV' => 'Latvia',
    // 'LB' => 'Lebanon',
    // 'LS' => 'Lesotho',
    // 'LR' => 'Liberia',
    // 'LY' => 'Libya',
    // 'LI' => 'Liechtenstein',
    // 'LT' => 'Lithuania',
    // 'LU' => 'Luxembourg',
    // 'MO' => 'Macao',
    // 'MG' => 'Madagascar',
    // 'MW' => 'Malawi',
    // 'MY' => 'Malaysia',
    // 'MV' => 'Maldives',
    // 'ML' => 'Mali',
    // 'MT' => 'Malta',
    // 'MH' => 'Marshall Islands',
    // 'MQ' => 'Martinique',
    // 'MR' => 'Mauritania',
    // 'MU' => 'Mauritius',
    // 'MX' => 'Mexico',
    // 'FM' => 'Micronesia',
    // 'MD' => 'Moldova',
    // 'MC' => 'Monaco',
    // 'MN' => 'Mongolia',
    // 'ME' => 'Montenegro',
    // 'MA' => 'Morocco',
    // 'MZ' => 'Mozambique',
    // 'MM' => 'Myanmar',
    // 'NA' => 'Namibia',
    // 'NP' => 'Nepal',
    // 'NL' => 'Netherlands',
    // 'NZ' => 'New Zealand',
    // 'NI' => 'Nicaragua',
    // 'NE' => 'Niger',
    // 'NG' => 'Nigeria',
    // 'NO' => 'Norway',
    // 'OM' => 'Oman',
    // 'PK' => 'Pakistan',
    // 'PW' => 'Palau',
    // 'PS' => 'Palestine',
    // 'PA' => 'Panama',
    // 'PG' => 'Papua New Guinea',
    // 'PY' => 'Paraguay',
    // 'PE' => 'Peru',
    // 'PH' => 'Philippines',
    // 'PL' => 'Poland',
    // 'PT' => 'Portugal',
    // 'QA' => 'Qatar',
    // 'RO' => 'Romania',
    // 'RU' => 'Russian Federation',
    // 'RW' => 'Rwanda',
    // 'SA' => 'Saudi Arabia',
    // 'SN' => 'Senegal',
    // 'RS' => 'Serbia',
    // 'SC' => 'Seychelles',
    // 'SL' => 'Sierra Leone',
    // 'SG' => 'Singapore',
    // 'SK' => 'Slovakia',
    // 'SI' => 'Slovenia',
    // 'SB' => 'Solomon Islands',
    // 'SO' => 'Somalia',
    // 'ZA' => 'South Africa',
    // 'ES' => 'Spain',
    // 'LK' => 'Sri Lanka',
    // 'SD' => 'Sudan',
    // 'SR' => 'Suriname',
    // 'SE' => 'Sweden',
    // 'CH' => 'Switzerland',
    // 'SY' => 'Syrian Arab Republic',
    // 'TW' => 'Taiwan',
    // 'TJ' => 'Tajikistan',
    // 'TZ' => 'Tanzania',
    // 'TH' => 'Thailand',
    // 'TL' => 'Timor-Leste',
    // 'TG' => 'Togo',
    // 'TO' => 'Tonga',
    // 'TT' => 'Trinidad and Tobago',
    // 'TN' => 'Tunisia',
    // 'TR' => 'TÃ¼rkiye',
    // 'TM' => 'Turkmenistan',
    // 'UG' => 'Uganda',
    // 'UA' => 'Ukraine',
    // 'AE' => 'United Arab Emirates',
    // 'GB' => 'United Kingdom',
    // 'US' => 'United States',
    // 'UY' => 'Uruguay',
    // 'UZ' => 'Uzbekistan',
    // 'VU' => 'Vanuatu',
    // 'VE' => 'Venezuela',
    // 'VN' => 'Viet Nam',
    // 'YE' => 'Yemen',
    // 'ZM' => 'Zambia',
    // 'ZW' => 'Zimbabwe'
];
$indian_states = [
    "andhra_pradesh"    => "Andhra Pradesh",
    "arunachal_pradesh" => "Arunachal Pradesh",
    "assam"             => "Assam",
    "bihar"             => "Bihar",
    "chhattisgarh"      => "Chhattisgarh",
    "goa"               => "Goa",
    "gujarat"           => "Gujarat",
    "haryana"           => "Haryana",
    "himachal_pradesh"  => "Himachal Pradesh",
    "jharkhand"         => "Jharkhand",
    "karnataka"         => "Karnataka",
    "kerala"            => "Kerala",
    "madhya_pradesh"    => "Madhya Pradesh",
    "maharashtra"       => "Maharashtra",
    "manipur"           => "Manipur",
    "meghalaya"         => "Meghalaya",
    "mizoram"           => "Mizoram",
    "nagaland"          => "Nagaland",
    "odisha"            => "Odisha",
    "punjab"            => "Punjab",
    "rajasthan"         => "Rajasthan",
    "sikkim"            => "Sikkim",
    "tamil_nadu"        => "Tamil Nadu",
    "telangana"         => "Telangana",
    "tripura"           => "Tripura",
    "uttar_pradesh"     => "Uttar Pradesh",
    "uttarakhand"       => "Uttarakhand",
    "west_bengal"       => "West Bengal"
];
?>
<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Dhaval Kankad">
    <meta name="viewport" content="width=1024">
    <title>Invoice</title>
    <link rel="stylesheet" href="<?php echo base_url('assets/invoice/css/style.css'); ?>">
    <style type="text/css" media="print">
        @page {
            size: auto;
            margin: 0mm;
        }
    </style>
    <script>
        const BASE_URL = "<?= base_url(); ?>";
    </script>
</head>

<body>
    <div class="tm_container">
        <div class="tm_invoice_wrap">
            <div class="tm_invoice tm_style3" id="tm_download_section">
                <div class="tm_invoice_in">
                    <div class="tm_invoice_head tm_align_center tm_accent_bg">
                        <div class="tm_invoice_left">
                            <div class="tm_logo">
                                <!-- <img src="<?php echo base_url('assets/invoice/img/favicon.png'); ?>" alt="Logo"> -->
                            </div>
                        </div>
                        <div class="tm_invoice_right">
                            <div class="tm_head_address tm_white_color">
                                <p class="tm_mb2"><?= $invoice_settings['company_name']; ?></p>
                                <p class="tm_mb2"><?= str_replace(',', ',<br>', $invoice_settings['address']); ?></p>
                                <p class="tm_mb2"><?= $invoice_settings['city']; ?>, <?= $invoice_settings['state']; ?> <?= $invoice_settings['country']; ?> <?= $invoice_settings['zipcode']; ?></p>
                                <p class="tm_mb2">Email: <?= $invoice_settings['email']; ?></p>
                                <p class="tm_mb2">Phone no.: <?= $invoice_settings['phone_no']; ?></p>
                            </div>
                        </div>
                        <div class="tm_primary_color tm_text_uppercase tm_watermark_title tm_white_color">Invoice</div>
                    </div>
                    <div class="tm_invoice_info">
                        <div class="tm_invoice_info_left tm_gray_bg">
                            <p class="tm_mb2"><b class="tm_primary_color">Invoice To:</b></p>
                            <p class="tm_mb0">
                                <?= $orders_details['first_name'] . ' ' . $orders_details['last_name']; ?> <br>
                                <?= str_replace(',', ',<br>', $orders_details['address']); ?><br>
                                <?= $orders_details['city'] . ', ' . (isset($indian_states[$orders_details['state']]) ? $indian_states[$orders_details['state']] : $orders_details['state']) . ' ' . (isset($countries[$orders_details['country']]) ? $countries[$orders_details['country']] : $orders_details['country']) . ' ' . $orders_details['zipcode']; ?> <br>
                                Email: <a class="__cf_email__"><?= $orders_details['email']; ?></a> <br>
                                Phone: <?= $orders_details['phone_no']; ?>
                            </p>
                        </div>
                        <div class="tm_invoice_info_right tm_text_right">
                            <p class="tm_invoice_number tm_m0">Order No: <b class="tm_primary_color">#<?= $orders_details['order_no']; ?></b></p>
                            <p class="tm_invoice_date tm_m0">Date: <b class="tm_primary_color"><?= dateFormat($orders_details['created_at'], true); ?></b></p>
                        </div>
                    </div>
                    <div class="tm_invoice_details">
                        <?php if (isset($orders_details['order_items_details']) && !empty($orders_details['order_items_details'])) { ?>
                            <div class="tm_table tm_style1 tm_mb30">
                                <div class="tm_border">
                                    <div class="tm_table_responsive">
                                        <table class="tm_gray_bg">
                                            <thead>
                                                <tr>
                                                    <th class="tm_width_1 tm_semi_bold tm_white_color tm_accent_bg tm_text_center">No.</th>
                                                    <th class="tm_width_5 tm_semi_bold tm_white_color tm_accent_bg tm_border_left tm_text_center">Product Details</th>
                                                    <th class="tm_width_1 tm_semi_bold tm_white_color tm_accent_bg tm_border_left tm_text_center">Qty</th>
                                                    <th class="tm_width_2 tm_semi_bold tm_white_color tm_accent_bg tm_border_left tm_text_center">Price</th>
                                                    <th class="tm_width_2 tm_semi_bold tm_white_color tm_accent_bg tm_border_left tm_text_center">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                $i = 1;
                                                foreach ($orders_details['order_items_details'] as $key => $item_row) { ?>
                                                    <tr>
                                                        <td class="tm_width_1 tm_text_center"><?= $i; ?></td>
                                                        <td class="tm_width_5 tm_border_left"><?= $item_row['product_name']; ?></td>
                                                        <td class="tm_width_1 tm_border_left tm_text_center"><?= $item_row['quantity']; ?></td>
                                                        <td class="tm_width_2 tm_border_left tm_text_center"><?= $item_row['amount'] ? amount($item_row['amount']) : ''; ?></td>
                                                        <td class="tm_width_2 tm_border_left tm_text_center"><?= $item_row['subtotal'] ? amount($item_row['subtotal']) : ''; ?></td>
                                                    </tr>
                                                <?php $i++;
                                                } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tm_invoice_footer">
                                    <div class="tm_left_footer">
                                        <?php if (isset($payment_details) && !empty($payment_details)) { ?>
                                            <p class="tm_mb2"><b class="tm_primary_color">Payment info:</b></p>
                                            <p class="tm_m0">Transaction ID: <?= $payment_details['transaction_id']; ?></p>
                                            <p class="tm_m0">Amount: <?= amount($payment_details['amount']); ?></p>
                                            <p class="tm_m0">Datetime: <?= dateFormat($payment_details['transaction_datetime']); ?></p>
                                        <?php } ?>
                                    </div>
                                    <div class="tm_right_footer">
                                        <table class="tm_gray_bg">
                                            <tbody>
                                                <?php
                                                $grand_total = $orders_details['subtotal'];
                                                $gst_rate = 18;
                                                // Calculate taxable amount and gst
                                                $net_amount = $grand_total / (1 + $gst_rate / 100);
                                                $gst_amount = $grand_total - $net_amount;
                                                // Check state
                                                $customer_state = strtolower($orders_details['state']); // adjust key as per your array
                                                $is_gujarat = ($customer_state === 'gujarat');
                                                ?>
                                                <tr>
                                                    <td class="tm_width_3 tm_primary_color tm_bold">Taxable Amount</td>
                                                    <td class="tm_width_3 tm_primary_color tm_text_center tm_bold">
                                                        <?= amount($net_amount); ?>
                                                    </td>
                                                </tr>
                                                <?php if ($is_gujarat): ?>
                                                    <?php
                                                    $cgst = $gst_amount / 2;
                                                    $sgst = $gst_amount / 2;
                                                    ?>
                                                    <tr>
                                                        <td class="tm_width_3 tm_primary_color tm_bold">CGST (9%)</td>
                                                        <td class="tm_width_3 tm_primary_color tm_text_center tm_bold">
                                                            <?= amount($cgst); ?>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="tm_width_3 tm_primary_color tm_bold">SGST (9%)</td>
                                                        <td class="tm_width_3 tm_primary_color tm_text_center tm_bold">
                                                            <?= amount($sgst); ?>
                                                        </td>
                                                    </tr>
                                                <?php else: ?>
                                                    <tr>
                                                        <td class="tm_width_3 tm_primary_color tm_bold">IGST (18%)</td>
                                                        <td class="tm_width_3 tm_primary_color tm_text_center tm_bold">
                                                            <?= amount($gst_amount); ?>
                                                        </td>
                                                    </tr>
                                                <?php endif; ?>
                                                <tr>
                                                    <td class="tm_width_3 tm_primary_color tm_bold">Total</td>
                                                    <td class="tm_width_3 tm_primary_color tm_text_center tm_bold"><?= $orders_details['subtotal'] ? amount($orders_details['subtotal']) : 0; ?></td>
                                                </tr>
                                                <?php if (isset($orders_details['coupon_code']) && !empty($orders_details['coupon_code'])) { ?>
                                                    <tr>
                                                        <td class="tm_width_3 tm_primary_color tm_bold">Discount (<?= $orders_details['coupon_code'] ? $orders_details['coupon_code'] : ''; ?>)</td>
                                                        <td class="tm_width_3 tm_primary_color tm_bold tm_text_center">- <?= $orders_details['discount'] ? amount($orders_details['discount']) : 0; ?></td>
                                                    </tr>
                                                <?php } ?>
                                                <tr class="tm_border_top tm_border_bottom tm_accent_bg">
                                                    <td class="tm_width_3 tm_border_top_0 tm_bold tm_f16 tm_white_color">Grand Total </td>
                                                    <td class="tm_width_3 tm_border_top_0 tm_bold tm_f16 tm_white_color tm_text_center"><?= $orders_details['grand_total'] ? amount($orders_details['grand_total']) : 0; ?></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        <?php } ?>
                        <div class="tm_padd_15_20 tm_gray_bg tm_page_break">
                            <p class="tm_mb5"><b class="tm_primary_color">Terms & Conditions:</b></p>
                            <ul class="tm_m0 tm_note_list">
                                <?= $invoice_settings['terms_condition']; ?>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tm_invoice_btns tm_hide_print">
                <!-- <a href="javascript:window.print()" class="tm_invoice_btn tm_color1">
                    <span class="tm_btn_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                            <path d="M384 368h24a40.12 40.12 0 0040-40V168a40.12 40.12 0 00-40-40H104a40.12 40.12 0 00-40 40v160a40.12 40.12 0 0040 40h24" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                            <rect x="128" y="240" width="256" height="208" rx="24.32" ry="24.32" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                            <path d="M384 128v-24a40.12 40.12 0 00-40-40H168a40.12 40.12 0 00-40 40v24" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
                            <circle cx="392" cy="184" r="24" fill='currentColor' />
                        </svg>
                    </span>
                    <span class="tm_btn_text">Print</span>
                </a> -->
                <button id="tm_download_btn" class="tm_invoice_btn tm_color2">
                    <span class="tm_btn_icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                            <path d="M320 336h76c55 0 100-21.21 100-75.6s-53-73.47-96-75.6C391.11 99.74 329 48 256 48c-69 0-113.44 45.79-128 91.2-60 5.7-112 35.88-112 98.4S70 336 136 336h56M192 400.1l64 63.9 64-63.9M256 224v224.03" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" />
                        </svg>
                    </span>
                    <span class="tm_btn_text">Download</span>
                </button>
            </div>
        </div>
    </div>
    <script src="<?php echo base_url('assets/invoice/js/jquery.min.js'); ?>"></script>
    <script src="<?php echo base_url('assets/invoice/js/jspdf.min.js'); ?>"></script>
    <script src="<?php echo base_url('assets/invoice/js/html2canvas.min.js'); ?>"></script>
    <script src="<?php echo base_url('assets/invoice/js/main.js'); ?>"></script>
</body>

</html>